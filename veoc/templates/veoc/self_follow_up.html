<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<!------ Include the above in your HEAD tag ---------->

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/css/intlTelInput.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput-jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput.min.js"></script>
<script src="/static/js/qrcode.js" type="text/javascript"></script>
<script src="/static/js/qrcode.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" integrity="sha256-c3RzsUWg+y2XljunEQS0LqWdQ04X1D3j22fd/8JCAKw=" crossorigin="anonymous"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

<style>
/* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 600px) {
  .col-25, .col-75, input[type=submit] {
    width: 100%;
    margin-top: 0;
  }
}
</style>
</head>
<div class="container">
<br>
    <div class="form_display_div">
        <div class="row justify-content-center">
            <div class="col-md-12">
            <div class="card">
            <header class="card-header" align="center">
                <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                <h4>MINISTRY OF HEALTH<br></h4>
                <h4 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h4>
            </header>
            <article class="card-body">
            <form class="airline_travellers_form">
            <h6> Fields marked with <span style="color:red">*</span> are required, they must be filled before submitting the form.</h6>
            <div>
                <hr>
                <h7><u>Reporting for <span style="color:red"> : </span> <span id="client_names"></span></u></h7>
            </div>
            <br>
                <div class="form-group" style="display: none;">
                    <input class="form-control" id="client_id" name="client_id">
                </div>
                <div class="form-row">
                    <div class="col form-group">
                        <label for="sex">Do you have a thermal gum or temperature ? <span style="color:red">*</span></label>
                        <select class="form-control" id="thermal_gun" name="thermal_gun" onchange="check_temperature()" required>
                          <option value="" disabled selected>Select your response</option>
                             <option value="YES">Yes</option>
                             <option value="NO">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row" id="temperature_div" style="display: none;">
                    <div class="col form-group">
                        <label for="destination_city">Enter Body temperature in degrees : </label>
                        <input class="form-control" type=number step=0.01 id="temperature" name="temperature" onchange="checkTemp()" placeholder="Enter temperature in degrees"/>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Have you developed fever ?* <span style="color:red">*</span> </label>
                         <select class="form-control" id="fever" name="fever" required>
                             <option value="" disabled selected>Select response</option>
                             <option value="YES">Yes</option>
                             <option value="NO">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Have you developed cough ? <span style="color:red">*</span> </label>
                         <select class="form-control" id="cough" name="cough" required>
                             <option value="" disabled selected>Select response</option>
                             <option value="YES">Yes</option>
                             <option value="NO">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Do you have difficulty in breathing ? <span style="color:red">*</span> </label>
                         <select class="form-control" id="breathing" name="breathing" required>
                             <option value="" disabled selected>Do you have a fever?</option>
                             <option value="YES">Yes</option>
                             <option value="NO">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="residence">Additional comments : </label>
                        <textarea class="form-control" id="comments" rows="3" name="comments" placeholder="Enter any additional comments"></textarea>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
            </form>
                <div>
                    <hr>
                    <button class="btn btn-lg btn-primary btn-block" type="button" onclick="submit_follow_up()"><i class="glyphicon glyphicon-save"></i> Submit</button>
                </div>
            </article> <!-- card-body end .// -->
            </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--Hidden div-->

    <div class="phone_num_div">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <header class="card-header" align="center">
                        <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                        <h4>MINISTRY OF HEALTH<br></h4>
                        <h4 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h4>
                    </header>
                    <article class="card-body">
                        <form class="phone_number_form">
                            <h6>Enter phone number to search for existing details. Starting with the country code (e.g +254700000000)</h6>
                            <div class="form-row">
                                <div class=" col form-group">
                                    <label for="phone_number">Phone Number : <span style="color:red">*</span></label>
                                    <input class="form-control" type="tel" id="phone_number" name="phone_number" required/>
                                    <span id="valid-msg" class="hide" style="color:green; display:none">Valid</span>
                                    <span id="error-msg" class="hide" style="color:red"></span>
                                    <small class="form-text text-muted">Select the correct country code first.</small>
                                </div> <!-- form-group end.// -->
                            </div> <!-- form-row end.// -->
                        </form>
                        <div>
                            <hr>
                            <button class="btn btn-lg btn-primary btn-block" type="button" onclick="check_number()"><i class="glyphicon glyphicon-save"></i> Submit</button>
                        </div>
                    </article> <!-- card-body end .// -->
                </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--phone_num_div-->

    <div class="names_registered_div">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <header class="card-header" align="center">
                        <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                        <h4>MINISTRY OF HEALTH<br></h4>
                        <h5 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h5>
                    </header>
                    <article class="card-body">
                        <form class="names_selection_form">
                            <h6> Select name of respondent to continue </h6>
                            <div class="form-row">
                                <div class="col form-group">
                                    <select class="form-control" name="user" id="user" required>
                                        <option value="" disabled selected>Select Names</option>
                                    </select>
                                </div> <!-- form-group end.// -->
                            </div> <!-- form-row end.// -->
                        </form>
                        <div>
                            <hr>
                            <button class="btn btn-lg btn-primary btn-block" type="button" onclick="show_follow_up_form()"><i class="glyphicon glyphicon-save"></i> Submit</button>
                        </div>
                    </article> <!-- card-body end .// -->
                </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--names_registered div-->

</div>
<!--container end.//-->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/jquery-ui-git.js" type="text/javascript"></script>
<link href="https://code.jquery.com/ui/jquery-ui-git.css" rel="Stylesheet" type="text/css" />
<script>
    $(document).ready(function() {

        $(".names_registered_div").hide();
        $(".phone_num_div").show();
        $(".form_display_div").hide();

    });

    function check_number(){
        var phone_number = $('#phone_number').val();
        while(phone_number.charAt(0) === '+'){
         phone_number = phone_number.substring(1);
        }
        console.log(phone_number);

        if(phone_number.length < 10){
            Swal.fire({
                title: 'Phone Number Error!',
                text: 'Please enter a valid Phone Number!',
                icon: 'error'
            });
        }else{
            var settings = {
{#              "url": "http://41.89.94.122/api/search/client",#}
              "url": "https://crossorigin.me/http://ears-api.mhealthkenya.co.ke/api/search/client",
              "method": "POST",
              "timeout": 0,
              "headers": {
                "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnQiOnsiaWQiOjY1MDAzLCJmaXJzdF9uYW1lIjoiU2FsbHlhbm5lIiwibWlkZGxlX25hbWUiOiIiLCJsYXN0X25hbWUiOiJXZXN0b24iLCJzZXgiOiJGZW1hbGUiLCJkb2IiOiIxOTcxLTA4LTI0IiwicGFzc3BvcnRfbnVtYmVyIjoiNTYwNzA0ODYyIiwicGhvbmVfbnVtYmVyIjoiKzI1NDcwNzU1MDMwNCIsImVtYWlsX2FkZHJlc3MiOiIiLCJvcmlnaW5fY291bnRyeSI6IlRIQUlMQU5EIiwicGxhY2Vfb2ZfZGlhZ25vc2lzIjoiIiwiZGF0ZV9vZl9jb250YWN0IjoiMjAyMC0wOC0xNCIsImNvbnRhY3RfdXVpZCI6ImMxZmYwMjc0M2VkZTQxNDM5MjEzNWY0ZjQzZjI1MjY3IiwiY29udGFjdF9zdGF0ZSI6IiIsImNvdW50eV9pZCI6MjYyMCwic3ViY291bnR5X2lkIjoyNjIwLCJ3YXJkX2lkIjoyNjIwLCJzb3VyY2UiOiJXZWIgQWlycG9ydCBTZWxmIFJlZ2lzdHJhdGlvbiIsImNyZWF0ZWRfYnlfaWQiOjEsInVwZGF0ZWRfYnlfaWQiOjEsImNyZWF0ZWRfYXQiOiIyMDIwLTA4LTE0VDIwOjQwOjUyLjAwMFoiLCJ1cGRhdGVkX2F0IjoiMjAyMC0wOC0xNFQyMDo0MTowMi4wMDBaIiwibmF0aW9uYWxpdHkiOiJVTklURUQgS0lOR0RPTSIsImNvcm1vYmlkaXR5IjoiTm9uZSIsImRydWdzIjoiTm9uZSIsIm5vayI6IkxpbGlhbiBNdW5lbmUiLCJub2tfcGhvbmVfbnVtIjoiMDcwNzU1MDMwNCIsInF1YXJhbnRpbmVfc2l0ZV9pZCI6MSwicGh5c2ljYWxfYWRkcmVzcyI6IiIsImNvbW11bmljYXRpb25fbGFuZ3VhZ2VfaWQiOjEsImFjdGl2ZV9mb2xsb3dfdXAiOnRydWUsImRyaXZlcl9uYXRpb25hbF9pZCI6bnVsbCwiYWdlIjpudWxsLCJlbWFpbF9zZW50IjoxLCJjcmVhdGVkQXQiOiIyMDIwLTA4LTE0VDIwOjQwOjUyLjAwMFoiLCJ1cGRhdGVkQXQiOiIyMDIwLTA4LTE0VDIwOjQxOjAyLjAwMFoifSwiaWF0IjoxNTk4MjQwMjQxfQ.Kt3gZvUeAEHFTwE1wCUeM10DMb-_wqjjrOIGBIjgyfM",
                "Content-Type": "application/json"
              },
              "data": JSON.stringify({"phone_no":phone_number}),
            };

            $.ajax(settings).done(function (response) {
                console.log(response);

                if(response.clients.length > 0){

                    $("#user").empty();
                    var please_select = "<option value=''>Please Select name to confirm parson : </option>";
                    $("#user").append(please_select);

                    $(".names_registered_div").show();
                    $(".phone_num_div").hide();
                    $(".form_display_div").hide();

                    for (i=0; i < response.clients.length; i++) {
                        var option_tag = "<option value='" + response.clients[i].id + "' data-user_names='" +response.clients[i].first_name + " " + response.clients[i].last_name + "'>" + response.clients[i].first_name + " " + response.clients[i].last_name + "</option>";
                        $("#user").append(option_tag);
                    }

                }else{
                    Swal.fire({
                        title: 'Phone Number Error!',
                        text: 'Phone Number entered is NOT registered in the system',
                        icon: 'error'
                    });
                }
            });

        }

    }

    //function to set up client id on the form
    $('#user').change(function () {
        console.log("inside change function")
        var client_id=$(this).find('option:selected').attr('value');
        var client_names=$(this).find('option:selected').attr('data-user_names');
        console.log(client_id);
        console.log(client_names);
        $('#client_id').val(client_id);
        document.getElementById("client_names").innerHTML = client_names;
    });

    //function to manage followup divs displaying
    function show_follow_up_form() {

        var user = $('#user').val();
        console.log(user);

        if(user.trim() === ""){
            Swal.fire({
                title: 'Input Error!',
                text: 'Please select your name as the respondent',
                icon: 'error'
            });
        }else{
            $(".phone_num_div").hide();
            $(".names_registered_div").hide();
            $(".form_display_div").show();
        }

    }

    //Function to display temperature input
    function check_temperature(){
        var thermal_gun = $('#thermal_gun').val();
        console.log(thermal_gun);
        if(thermal_gun == 'YES'){
            $("#temperature_div").show();
        }else{
            $("#temperature_div").hide();
        }
    }

    //Validation function for temperature input
    function checkTemp(){
       var temp = $('#temperature').val();
       if(temp.length > 4 || temp.length < 2){
         console.log("Enter valid temperature");
         Swal.fire({
           title: 'error!',
           text: 'Enter a valid temperature measure',
           icon: 'error'
         });
         document.getElementById("temperature").focus();
       }else if(temp < 34 || temp > 45){
         Swal.fire({
           title: 'error!',
           text: 'Temperature value should be between 34 and 45 Degrees',
           icon: 'error'
         });
         document.getElementById("temperature").focus();
       }
     }

    //function to submit followup entries
    function submit_follow_up(){

        var thermal_gun = $('#thermal_gun').val();
        var temperature = $('#temperature').val();
        var client_id = $('#client_id').val();
        var fever = $('#fever').val();
        var cough = $('#cough').val();
        var breathing = $('#breathing').val();
        var comments = $('#comments').val();

        if(temperature.length === 0){
            temperature = 0;
        }

        var settings = {
{#          "url": "http://41.89.94.122/api/response",#}
          "url": "https://crossorigin.me/http://ears-api.mhealthkenya.co.ke/api/response",
          "method": "POST",
          "timeout": 0,
          "headers": {
            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnQiOnsiaWQiOjY1MDAzLCJmaXJzdF9uYW1lIjoiU2FsbHlhbm5lIiwibWlkZGxlX25hbWUiOiIiLCJsYXN0X25hbWUiOiJXZXN0b24iLCJzZXgiOiJGZW1hbGUiLCJkb2IiOiIxOTcxLTA4LTI0IiwicGFzc3BvcnRfbnVtYmVyIjoiNTYwNzA0ODYyIiwicGhvbmVfbnVtYmVyIjoiKzI1NDcwNzU1MDMwNCIsImVtYWlsX2FkZHJlc3MiOiIiLCJvcmlnaW5fY291bnRyeSI6IlRIQUlMQU5EIiwicGxhY2Vfb2ZfZGlhZ25vc2lzIjoiIiwiZGF0ZV9vZl9jb250YWN0IjoiMjAyMC0wOC0xNCIsImNvbnRhY3RfdXVpZCI6ImMxZmYwMjc0M2VkZTQxNDM5MjEzNWY0ZjQzZjI1MjY3IiwiY29udGFjdF9zdGF0ZSI6IiIsImNvdW50eV9pZCI6MjYyMCwic3ViY291bnR5X2lkIjoyNjIwLCJ3YXJkX2lkIjoyNjIwLCJzb3VyY2UiOiJXZWIgQWlycG9ydCBTZWxmIFJlZ2lzdHJhdGlvbiIsImNyZWF0ZWRfYnlfaWQiOjEsInVwZGF0ZWRfYnlfaWQiOjEsImNyZWF0ZWRfYXQiOiIyMDIwLTA4LTE0VDIwOjQwOjUyLjAwMFoiLCJ1cGRhdGVkX2F0IjoiMjAyMC0wOC0xNFQyMDo0MTowMi4wMDBaIiwibmF0aW9uYWxpdHkiOiJVTklURUQgS0lOR0RPTSIsImNvcm1vYmlkaXR5IjoiTm9uZSIsImRydWdzIjoiTm9uZSIsIm5vayI6IkxpbGlhbiBNdW5lbmUiLCJub2tfcGhvbmVfbnVtIjoiMDcwNzU1MDMwNCIsInF1YXJhbnRpbmVfc2l0ZV9pZCI6MSwicGh5c2ljYWxfYWRkcmVzcyI6IiIsImNvbW11bmljYXRpb25fbGFuZ3VhZ2VfaWQiOjEsImFjdGl2ZV9mb2xsb3dfdXAiOnRydWUsImRyaXZlcl9uYXRpb25hbF9pZCI6bnVsbCwiYWdlIjpudWxsLCJlbWFpbF9zZW50IjoxLCJjcmVhdGVkQXQiOiIyMDIwLTA4LTE0VDIwOjQwOjUyLjAwMFoiLCJ1cGRhdGVkQXQiOiIyMDIwLTA4LTE0VDIwOjQxOjAyLjAwMFoifSwiaWF0IjoxNTk4MjQwMjQxfQ.Kt3gZvUeAEHFTwE1wCUeM10DMb-_wqjjrOIGBIjgyfM",
            "Content-Type": "application/json"
          },
          "data": JSON.stringify({"client_id":client_id,"thermal_gun":thermal_gun,"body_temp":temperature,fever:fever,"cough":cough,"difficult_breathing":breathing,"comment":comments}),
        };


        $.ajax(settings).done(function (response) {
          console.log(response.message);
            var msg = response.message;
            if(response.success === "false"){
                Swal.fire({
                   title: 'Response!',
                   text: msg,
                   icon: 'error'
                 });
            }else{
                Swal.fire({
                   title: 'Response!',
                   text: msg,
                   icon: 'success'
                 });
            }

        });

    }

</script>
