<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<!------ Include the above in your HEAD tag ---------->

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/css/intlTelInput.css">


<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput-jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.3/js/intlTelInput.min.js"></script>
<script src="/static/js/qrcode.js" type="text/javascript"></script>
<script src="/static/js/qrcode.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" integrity="sha256-c3RzsUWg+y2XljunEQS0LqWdQ04X1D3j22fd/8JCAKw=" crossorigin="anonymous"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

<style>
/* Responsive layout - when the screen is less than 600px wide, make the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 600px) {
  .col-25, .col-75, input[type=submit] {
    width: 100%;
    margin-top: 0;
  }
}
</style>
</head>
<div class="container">
<br>
    <div class="form_display_div" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-md-12">
            <div class="card">
            <header class="card-header" align="center">
                <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                <h4>MINISTRY OF HEALTH<br></h4>
                <h4 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h4>
            </header>
            <article class="card-body">
            <form class="airline_travellers_form">
            {% csrf_token %}
            <h6> Fields marked with <span style="color:red">*</span> are required, they must be filled before submitting the form.</h6>
            <br>
                <div class="form-row">
                    <div class="col form-group">
                        <label for="sex">DO you have a thermal gum or temperature ?* <span style="color:red">*</span></label>
                        <select class="form-control" id="thermal_gun" name="thermal_gun" required>
                          <option value="" disabled selected>Select your response</option>
                             <option value="Yes">Yes</option>
                             <option value="No">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="destination_city">Enter Body temperature in degrees : </label>
                        <input class="form-control" type="text" id="temperature" name="temperature" size="45" placeholder="Enter temperature in degrees"/>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Have you developed fever ?* <span style="color:red">*</span> </label>
                         <select class="form-control" id="fever" name="fever" required>
                             <option value="" disabled selected>Select response</option>
                             <option value="t">Yes</option>
                             <option value="f">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Have you developed cough ?* <span style="color:red">*</span> </label>
                         <select class="form-control" id="cough" name="cough" required>
                             <option value="" disabled selected>Select response</option>
                             <option value="t">Yes</option>
                             <option value="f">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="fever">Do you have difficulty in breathing ?* <span style="color:red">*</span> </label>
                         <select class="form-control" id="breathing" name="breathing" required>
                             <option value="" disabled selected>Do you have a fever?</option>
                             <option value="t">Yes</option>
                             <option value="f">No</option>
                         </select>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-row">
                    <div class="col form-group">
                        <label for="residence">Additional comments : </label>
                        <textarea class="form-control" id="comments" rows="3" name="comments" placeholder="Enter any additional comments"></textarea>
                    </div> <!-- form-group end.// -->
                </div> <!-- form-row end.// -->
                <div class="form-group">
                    <button type="submit" id="save_button" class="btn btn-primary btn-block"> Submit  </button>
                </div> <!-- form-group// -->

            </form>
            </article> <!-- card-body end .// -->
            </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--Hidden div-->

    <div class="phone_num_div">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <header class="card-header" align="center">
                        <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                        <h4>MINISTRY OF HEALTH<br></h4>
                        <h4 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h4>
                    </header>
                    <article class="card-body">
                        <form class="phone_number_form">
                            <h6>Enter phone number to search for existing details. Starting with the country code (e.g +254700000000)</h6>
                            {% csrf_token %}
                            <div class="form-row">
                                <div class=" col form-group">
                                    <label for="phone_number">Phone Number : <span style="color:red">*</span></label>
                                    <input class="form-control" type="tel" id="phone_number" name="phone_number" onchange="checkPhone()" minlength = "6" required/>
                                    <span id="valid-msg" class="hide" style="color:green; display:none">Valid</span>
                                    <span id="error-msg" class="hide" style="color:red"></span>
                                    <small class="form-text text-muted">Select the correct country code first.</small>
                                </div> <!-- form-group end.// -->
                            </div> <!-- form-row end.// -->
                            <div class="form-group">
                                <button type="submit" id="save_button" class="btn btn-primary btn-block"> Submit  </button>
                            </div> <!-- form-group// -->
                        </form>
                    </article> <!-- card-body end .// -->
                </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--phone_num_div-->

    <div class="names_registered_div" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card">
                    <header class="card-header" align="center">
                        <img src="/static/images/emblem.png" style="width:40%; max-width:100px;">
                        <h4>MINISTRY OF HEALTH<br></h4>
                        <h5 class="card-title mt-2" align="center">Jitenge Self Reporting Form</h5>
                    </header>
                    <article class="card-body">
                        <form class="names_selection_form">
                            <h6> Select name of respondent to continue </h6>
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="col form-group">
                                    <label for="nationality">Select user reporting :  <span style="color:red">*</span></label>
                                    <select class="form-control" name="user" id="user" required>
                                        <option value="" disabled selected>Select Names</option>
                                    </select>
                                </div> <!-- form-group end.// -->
                            </div> <!-- form-row end.// -->
                            <div class="form-group">
                                <button type="submit" id="save_button" class="btn btn-primary btn-block" onclick="show_follow_up_form()">Submit</button>
                            </div> <!-- form-group// -->
                        </form>
                    </article> <!-- card-body end .// -->
                </div> <!-- card.// -->
            </div> <!-- col.//-->
        </div> <!-- row.//-->
    </div> <!--names_registered div-->

</div>
<!--container end.//-->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/jquery-ui-git.js" type="text/javascript"></script>
<link href="https://code.jquery.com/ui/jquery-ui-git.css" rel="Stylesheet" type="text/css" />
<script>
    $(document).ready(function() {

        var travellersForm = $(".airline_travellers_form")

        travellersForm.submit(function(e){
            e.preventDefault();
            var thisForm = $(this);
            var endPoint = thisForm.attr("action") || window.location.href;
            var method = thisForm.attr("method");
            var formData = thisForm.serialize();

            Swal.fire({
                title: "Please wait,Saving Details!",
                imageUrl: "/static/images/ajax-loader.gif",
                showConfirmButton: false,
                allowOutsideClick: false
            });
            $.ajax({
                type:method,
                url:endPoint,
                data: formData,
                success:function(data){
                    if(data == "error"){
                      Swal.fire({
                        title: 'Duplicate Data Entry!!',
                        text: 'Names and Phone number entered already exist in the system and still ongoing quarantine!!',
                        icon: 'info'
                      });
                    }else {
                        Swal.fire({
                            title: 'Success!',
                            text: 'Travellers Details Saved',
                            icon: 'success'
                        });
                        travellersForm[0].reset();
                    }
                },
                error:function(er){
                    console.log("Airport Quarantine saving error");
                    console.log(er.responseText);
                    Swal.fire({
                        title: 'Error!',
                        text: 'Airport Quarantine Details Cannot be Saved',
                        icon: 'error'
                    });
                }
            });
        });

        var phone_number_form = $(".phone_number_form");
        var formData = thisForm.serialize();

        var settings = {
            "async": true,
            "crossDomain": true,
            "url": "",
            "data": formData,
            "method": "GET",
            "headers": {
                "cache-control": "no-cache",
                "postman-token": "376d32db-5367-9d3f-fee5-00319590bf22"
            }
        }

        $.ajax(settings).done(function (response) {
            console.log(response);
            //Check if response has values
            //if(response){
            // }else{
            // }
            $(".user").empty();
            var please_select = "<option value=''>Please Select user : </option>";
            $(".user").append(please_select);
            $(".names_registered_div").show();
            $(".phone_num_div").hide();
            $(".form_display_div").hide();
            $.each(response, function (i, value) {
                var option_tag = "<option value='" + value.first_name + "'>" + value.first_name + "</option>";
                $(".user").append(option_tag);
            });
        });

    });

    function show_follow_up_form() {

        var phone_number_form = $(".names_selection_form");
        console.log(phone_number_form);
        $(".names_registered_div").hide();
        $(".phone_num_div").hide();
        $(".form_display_div").show();

    }

</script>
